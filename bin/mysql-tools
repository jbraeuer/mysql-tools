#! /usr/bin/env ruby1.9.1

$: << File.expand_path(File.dirname(File.realpath(__FILE__)) + '/../lib')
require 'mysql_tools'

include GLI

pre do |global,command,options,args|
  setup_logging(global)

  return true if command.nil?

  case command.name
  when :backup
    MysqlTools::Backup.pre(global, options, args)
  when :initobfuscate
    MysqlTools::InitObfuscate.pre(global, options, args)
  when :obfuscate
    MysqlTools::Obfuscate.pre(global, options, args)
  when :restore
    MysqlTools::Restore.pre(global, options, args)
  else
    true
  end
end

program_desc 'Backup, Restore and Obfuscate Mysql databases.'
version      IO.read(File.expand_path(File.dirname(File.realpath(__FILE__)) + '/../VERSION')).strip
config_file  ".mysql-tools.rc"

desc "Username for Mysql connection"
arg_name "USER"
default_value "root"
flag [:username, :u]

desc "Password for Mysql connection"
arg_name "PASS"
default_value "secret"
flag [:password, :p]

desc "Mysql host to connect"
arg_name "HOST"
default_value "localhost"
flag [:host]

desc "Verbose mode"
default_value false
switch [:verbose]

MysqlTools::Backup.init
MysqlTools::Restore.init
MysqlTools::Obfuscate.init
MysqlTools::InitObfuscate.init

exit GLI.run(ARGV)
