#! /usr/bin/env ruby1.9.1

$: << File.expand_path(File.dirname(File.realpath(__FILE__)) + '/../lib')
require 'mysql_tools'

include GLI

pre do |global,command,options,args|
  setup_logging(global)

  case command.name
  when :backup
    MysqlTools::Backup.pre(global, options, args)
  else
    true
  end
end

program_desc 'Backup, Restore and Obfuscate Mysql databases.'
version      IO.read(File.expand_path(File.dirname(File.realpath(__FILE__)) + '/../VERSION')).strip

desc "Username for Mysql connection"
arg_name "USER"
default_value "root"
flag [:u, :username]

desc "Password for Mysql connection"
arg_name "PASS"
default_value "secret"
flag [:p, :password]

desc "Mysql host to connect"
arg_name "HOST"
default_value "localhost"
flag [:host]

desc "Verbose mode"
default_value false
switch [:verbose]

desc "Backup a database"
arg_name "database_name"
command :backup do |c|
  c.action do |global,command,args|
    puts "#{global.inspect}"
    puts "#{command.inspect}"
    puts "#{args.inspect}"
  end
end

exit GLI.run(ARGV)
